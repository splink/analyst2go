<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Embedded Plotly Chart</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        /* Responsive container with aspect ratio 16:9 */
        #chartContainer {
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* 16:9 Aspect Ratio (9 / 16 = 0.5625) */
        }

        /* Inner div to hold the chart */
        #plot {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* Image preview and output styles */
        #imagePreview {
            max-width: 300px;
            max-height: 300px;
            margin-top: 20px;
            display: none;
        }
        #output {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Generated Plotly Chart</h1>
    <p>Press <strong>Ctrl+V</strong> or <strong>Cmd+V</strong> to paste a screenshot.</p>

    <!-- Placeholder container for the Plotly chart -->
    <div id="chartContainer">
        <div id="plot"></div>
    </div>

    <!-- Image preview and output for the extracted data -->
    <img id="imagePreview" src="" alt="Pasted Image Preview">
    <div id="output"></div>

    <script>
        // JavaScript for handling image paste and upload to backend
        document.addEventListener('paste', async function (event) {
            const items = (event.clipboardData || event.originalEvent.clipboardData).items;
            let blob = null;

            // Check if any pasted item is an image
            for (let i = 0; i < items.length; i++) {
                if (items[i].type.indexOf("image") === 0) {
                    blob = items[i].getAsFile();
                    break;
                }
            }

            if (blob) {
                // Display image preview
                const preview = document.getElementById("imagePreview");
                preview.src = URL.createObjectURL(blob);
                preview.style.display = "block";

                // Create a FormData object and append the image blob
                const formData = new FormData();
                formData.append("screenshot", blob);

                // Send the image to the backend using fetch
                try {
                    const response = await fetch("/upload", {
                        method: "POST",
                        body: formData
                    });

                    if (!response.ok) {
                        throw new Error(`Server error: ${response.statusText}`);
                    }

                    // Parse and handle the JSON response
                    const result = await response.json();
                    document.getElementById("output").innerHTML = `<h2>Extracted Data:</h2><pre>${JSON.stringify(result, null, 2)}</pre>`;
                } catch (error) {
                    console.error("Upload failed:", error);
                    document.getElementById("output").innerHTML = `<h2>Error:</h2><p>${error.message}</p>`;
                }
            } else {
                alert("Please paste an image.");
            }
        });

        // Parse the Plotly JSON data passed from the Go server
        const plotlyData = {{ .PlotlyJSON }};
        const config = {
            responsive: true,
            displayModeBar: false,  // Disables the toolbar entirely
            displaylogo: false      // Removes the "Produced with Plotly" button
        };

        // Chart layout options to enable "compare data on hover"
        const layout = plotlyData.layout || {};  // Retrieve the existing layout or create an empty one
        layout.hovermode = 'x unified';          // Set default hover behavior to "compare data on hover"

        // Render the Plotly chart in the specified container
        Plotly.newPlot("plot", plotlyData.data, layout, config);
    </script>
</body>
</html>

